<!doctype html><!--The html below comes from http://demo.nginx.com/status.html--><html lang=en><head><meta charset=utf-8><title>nginx vhost traffic status monitor</title><style>body{background:white;color:black;font-family:Helvetica,Arial,sans-serif}h1{margin:.5em 0 0 0}h2{margin:.8em 0 .3em 0}h3{margin:.5em 0 .3em 0}table{font-size:.8em;margin:.5em 0;border-collapse:collapse;border-bottom:1px #DED solid}thead th{font-size:1em;background:#DED;padding:.1em .3em;border:.2em solid #FFF}tbody tr.odd{background:#f5f5f5}tbody th{text-align:left}tbody td{height:1.2em;text-align:right}tbody td.key{font-size:1em;background:#DED;padding:.1em .3em;border:.2em solid #FFF}</style></head><body><h1>Nginx Vhost Traffic Status</h1><div id=monitor></div><script>var vtsStatusURI="{{uri}}/format/json",vtsUpdateInterval=1000;var aPs=(function(){var a=[];var b={last:undefined,period:undefined};return{getValue:function(c,d){if(typeof a[c]==="undefined"){a[c]=d;return"n/a"}else{var e=d-a[c];a[c]=d;return Math.floor(e*1000/b.period)}},refresh:function(c){b.period=c-b.last;b.last=c}}})();function mTh(b){var a=1000,c=60,f=c*c,g=f*24,l="";if(b<a){return b+"ms"}if(b<(a*100)){return Math.floor(b/a)+"."+Math.floor((b%a)/10)+"s"}var k=Math.floor(b/(g*a));if(k){l+=k+"d "}var i=Math.floor((b%(g*a))/(f*a));if(k||i){l+=i+"h "}var e=Math.floor(((b%(g*a))%(f*a))/(c*a));if(k||i||e){l+=e+"m "}var j=Math.floor((((b%(g*a))%(f*a))%(c*a))/a);return l+j+"s"}function bTh(a){var c=1024;if(typeof a!=="number"){return a}if(a<c){return a+" B"}if(a<(c*c)){return(a/c).toFixed(1)+" KiB"}if(a<(c*c*c)){return(a/(c*c)).toFixed(1)+" MiB"}return(a/(c*c*c)).toFixed(2)+" GiB"}function sTh(a,e){var c;if(!a&&!e){c="up"}else{if(e){c="down"}else{c="backup"}}return c}function template(f){aPs.refresh(f.nowMsec);var e='<div id="serverInfos"><h2>Server main</h2><table><thead><tr><th rowspan="2">Version</th><th rowspan="2">Uptime</th><th colspan="4">Connections</th><th colspan="5">Requests</th></tr><tr><th>active</th><th>reading</th><th>writing</th><th>waiting</th><th>accepted</th><th>handled</th><th>Total</th><th>Req/s</th></tr></thead><tbody>';e+="<tr> <td>"+f.nginxVersion+"</td><td>"+mTh(f.nowMsec-f.loadMsec)+"</td><td>"+f.connections.active+"</td><td>"+f.connections.reading+"</td><td>"+f.connections.writing+"</td><td>"+f.connections.waiting+"</td><td>"+f.connections.accepted+"</td><td>"+f.connections.handled+"</td><td>"+f.connections.requests+"</td><td>"+aPs.getValue("serverInfos.connections.requests",f.connections.requests)+"</td></tr>";e+="</tbody></table></div>";e+='<div id="serverZones"><h2>Server zones</h2><table><thead><tr><th rowspan="2">Zone</th><th colspan="2">Requests</th><th colspan="6">Responses</th><th colspan="4">Traffic</th></tr><tr><th>Total</th><th>Req/s</th><th>1xx</th><th>2xx</th><th>3xx</th><th>4xx</th><th>5xx</th><th>Total</th><th>Sent</th><th>Rcvd</th><th>Sent/s</th><th>Rcvd/s</th></tr></thead><tbody> ';var c=0;for(var a in f.serverZones){var j=f.serverZones[a];e+="<tr ";e+=((c++%2)?'class="odd"':"");e+="><th>";e+=(a);e+="</th><td>";e+=(j.requestCounter);e+="</td><td>";e+=(aPs.getValue("serverZones."+a+".requestCounter",j.requestCounter));e+="</td> ";for(var b in j.responses){e+="<td>";e+=(j.responses[b]);e+="</td>"}var k=0;for(var b in j.responses){k+=j.responses[b]}e+="<td>"+k+"</td>";e+="<td>";e+=(bTh(j.outBytes));e+="</td><td>";e+=(bTh(j.inBytes));e+="</td><td>";e+=(bTh(aPs.getValue("serverZones."+a+".outBytes",j.outBytes)));e+="</td><td>";e+=(bTh(aPs.getValue("serverZones."+a+".inBytes",j.inBytes)));e+="</td></tr>"}e+=" </table></div>";if("upstreamZones" in f){e+='<div id="upstreamZones"><h2>Upstreams</h2>';for(var h in f.upstreamZones){e+="<h3>"+(h)+"</h3>";e+='<table><thead><tr><th rowspan="2">Server</th><th rowspan="2">State</th><th rowspan="2">Response Time</th><th rowspan="2">Weight</th><th rowspan="2">MaxFails</th><th rowspan="2">FailTimeout</th><th colspan="2">Requests</th><th colspan="6">Responses</th><th colspan="4">Traffic</th></tr><tr><th>Total</th><th>Req/s</th><th>1xx</th><th>2xx</th><th>3xx</th><th>4xx</th><th>5xx</th><th>Total</th><th>Sent</th><th>Rcvd</th><th>Sent/s</th><th>Rcvd/s</th></tr></thead><tbody>';var g=f.upstreamZones[h];if(g){var i,c=-1,d=g.length-1;while(c<d){i=g[c+=1];e+="<tr ";e+=((c%2)?'class="odd"':"");e+="><th>";e+=(i.server);e+="</th>";e+="<td>"+sTh(i.backup,i.down)+"</td>";e+="<td>"+mTh(i.responeMsec)+"</td>";e+="<td>"+i.weight+"</td>";e+="<td>"+i.maxFails+"</td>";e+="<td>"+i.failTimeout+"</td>";e+="<td>"+i.requestCounter+"</td>";e+="<td>"+(aPs.getValue("upstreamZones."+h+"."+i.server+".requestCounter",i.requestCounter))+"</td>";e+="</td> ";for(var b in i.responses){e+="<td>";e+=(i.responses[b]);e+="</td>"}var k=0;for(var b in i.responses){k+=i.responses[b]}e+="<td>"+k+"</td>";e+="<td>";e+=(bTh(i.outBytes));e+="</td><td>";e+=(bTh(i.inBytes));e+="</td><td>";e+=(bTh(aPs.getValue("serverZones."+h+"."+i.server+".outBytes",i.outBytes)));e+="</td><td>";e+=(bTh(aPs.getValue("serverZones."+h+"."+i.server+".inBytes",i.inBytes)));e+="</td></tr> "}}e+="</tbody></table>"}}return e}var monitor=document.getElementById("monitor");function vtsGetData(){var a=new XMLHttpRequest;a.onload=function(){if(this.status!=200){return}monitor.innerHTML=template(JSON.parse(this.responseText))};a.open("GET",vtsStatusURI);a.send()}vtsGetData();setInterval(vtsGetData,vtsUpdateInterval);</script></body></html>
